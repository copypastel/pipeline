<script>
  
  <% unless @video.nil? %>
  document.title = "Pipeline :: " + "<%= @video.title %>";

  function onYouTubePlayerReady(){
	alert("hi");
    var video = document.getElementById("video_player");
    video.loadVideoById("<%= @video.video_id %>", 0);
    video.playVideo();
    vid = "<%= @video.id %>";
    video.addEventListener("onStateChange", "pickNext");
  }
    
  function pickNext(state){
    if(state == 0){
      $.get("<%= url(:controller => 'videos', :action => 'next')%>", { id: vid }, function(response){
        if(response != "false"){
          var video = document.getElementById("video_player");
          video.loadVideoById(response.video_id, 0);
          video.playVideo();
          vid = response.id;
          video.addEventListener("onStateChange", "pickNext");
        };
      }, 'text');
    };
  };
  
  <% end %>
  
</script>